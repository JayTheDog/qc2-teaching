#!/bin/make -f

# name of your program
NAME := scf

MY_OBJS := main.o

# sources provided by your lab assistents
QC2_LIB := lib/integrals.o\
           lib/slater.o\
           lib/print_matrix.o\
           lib/linear_algebra.o\
           lib/io_tools.o

FC := gfortran
# use -O0 for debugging, -O2 is fine for production runs
FFLAGS := -O
FFLAGS += -ffree-form
# the nasty GNU compiler used to cut off lines, this is over now
FFLAGS += -ffree-line-length-none
# please, write Fortran2008, we have left the era of F77 already
FFLAGS += -pedantic
FFLAGS += -std=f2008

# local Lapack installation present?
HAS_LAPACK := no
# in case your system has no LAPACK installation present, we provide
# a minimal LAPACK implementation that will be used instead

.PHONY: all
all: $(NAME)

# libraries you want to use
ifeq ($(HAS_LAPACK),yes)
LIBS := -llapack
else
LAPACK_OBJS := lib/lapack.o
$(LAPACK_OBJS): %.o: %.f
	$(FC) -O2 -ffixed-form -c $< -o $@
endif

# this defines how to build your program
$(NAME): $(QC2_LIB) $(MY_OBJS) $(LAPACK_OBJS)
	$(FC) $^ $(LIBS) -o $@

$(MY_OBJS): %.o: %.f90 $(QC2_LIB)
	$(FC) $(FFLAGS) -c $< -o $@

$(QC2_LIB): %.o: %.f90
	$(FC) $(FFLAGS) -c $< -o $@


.PHONY: clean veryclean
# remove all object files generated by this Makfile
# filter first to avoid cleaning up (=deleting) student codez.
clean:
	$(RM) $(filter %.o,$(MY_OBJS) $(QC2_LIB))

# clean up, rigorously remove *all* object files, and modules, and binaries
veryclean:
	$(RM) *.o lib/*.o *.mod $(NAME)

